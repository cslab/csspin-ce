# This spinfile.yaml is only intended to be used for building the documentation
# using readthedocs.org.

spin:
    project_name: csspin-ce

plugin_packages:
    - csspin-docs
    - csspin-python[aws_auth]
    - -e .

plugins:
    - csspin_docs.sphinx
    - csspin_ce:
          - ce_services
          - ce_support_tools
          - localization
          - mkinstance
          - pkgtest

contact_elements:
    umbrella: '16.0'

python:
    version: '3.11.9'
    requirements:
        - sphinx-rtd-theme
    aws_auth:
        # required to access Codeartifact for cs.platform, cs.web, ce_services
        enabled: True
        static_oidc: True
        key_duration: 600 # 10 minutes
        role_arn: '{CS_AWS_OIDC_ROLE_ARN}'
        client_id: '{CS_AWS_OIDC_CLIENT_ID}'

node:
    version: '18.17.1'

sphinx:
    docs: doc

java:
    version: '21'

build_rules:
    task docs:
        sources: doc/_schemaref.rst
    doc/_schemaref.rst:
        sources: [src/csspin_ce]
        spin:
            - schemadoc ce_services --rst -o doc/plugins/ce_services_schemaref.rst
            - schemadoc mkinstance --rst -o doc/plugins/mkinstance_schemaref.rst
            - schemadoc pkgtest --rst -o doc/plugins/pkgtest_schemaref.rst
            - schemadoc localization --rst -o doc/plugins/localization_schemaref.rst
